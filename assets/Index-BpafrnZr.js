import{a as U,d as S,b as D,_ as A,r as T}from"./AppLayout-B4u2TX5M.js";import{_}from"./Spin-CrooxrbT.js";import{u as w,q as C,z as m,r as g,c as O,a as i,f as b,w as v,b as l,F as x,o as n,d as a,t as c,n as d,e as E,g as y,h as u}from"./index-CxZN97vy.js";const o=w(),$=C("admindbrt",{state:()=>({table:[],game:null,playerItems:[],selectItems:[],load:!1,showDeleteUser:!1}),actions:{validateItems(){const t=this.table&&o.auth?this.table.filter(e=>e.player&&e.player.id==o.auth.id):[];this.playerItems=t.length?t.map(e=>e.id):[]},validateSelectItems(){this.table.forEach(t=>{var e=this.selectItems.indexOf(t.id);e>=0&&t.user_id!=null&&this.selectItems.splice(e,1)})},async initGame(){let{data:t}=await m.from("game").select().single();this.game=t},async initTable(){let{data:t}=await m.from("table").select().order("id",{ascending:!0});this.table=t},async init(){await this.initGame(),await this.initTable()},async initOn(){this.load=!1,await this.init(),this.on(),this.load=!0},async on(){m.channel("custom-update-channel").on("postgres_changes",{event:"UPDATE",schema:"public",table:"table"},t=>{const e=this.table.findIndex(r=>r.id===t.new.id);e!==-1&&(this.table[e]=t.new),this.validateItems(),this.validateSelectItems()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"game"},t=>{this.load=!1,this.game=t.new,this.initTable(),this.load=!0}).subscribe()},async deleteUserInTable(t){await m.from("table").update({player:null}).eq("player->id",t.player.id),this.showDeleteUser=!1},async registerItemsPlayer(){let{data:t,error:e}=await m.rpc("register_items_player",{ids_array:this.selectItems,player_param:{id:o.auth.id,nick:o.auth.nick,avatar:o.auth.avatar,verified:o.auth.verified?1:0}});e&&console.error(e)}},getters:{getUserItemsSelect:t=>t.selectItems,getUserItemsSelectData:t=>{var e=t.table.filter(r=>t.selectItems.includes(r.id));return e},getUserItemsSelectDataOfCopy:t=>{var e="";return t.table.forEach(r=>{t.selectItems.includes(r.id)&&(e=e+(e==""?"":"-")+r.name)}),e},getUserItems:t=>t.playerItems,getUserItemsData:t=>{var e=t.table.filter(r=>r.player&&r.player.id==o.auth.id);return e},getUserItemsDataOfCopy:t=>{var e="";return t.table.forEach(r=>{t.playerItems.includes(r.id)&&(e=e+(e==""?"":"-")+r.name)}),e},getTableSpaceFree:t=>Math.floor(t.table.filter(e=>e.user_id==null).length/t.game.per_user),getTableSpaceTotal:t=>Math.floor(t.table.length/t.game.per_user),getTableSpaceOcuped:t=>Math.floor(t.table.filter(e=>e.user_id!=null).length/t.game.per_user)}}),N={class:"sm:max-w-[80rem] border-none mx-auto"},B=["data"],L={class:"relative px-6 items-center pt-4 pb-2 text-2xl font-bold uppercase border-none text-center"},F={class:"border-none text-center"},M={class:"px-2 py-1 rounded-md border-none uppercase font-bold"},P={class:"border-none"},j=["onClick"],z=["title"],G=["title"],R={key:0,class:"relative"},V={key:1,class:"pl-1 truncate"},q={class:"relative"},H={class:"-mt-3 pb-3 flex justify-between font-bold text-xs w-full px-1"},J={class:"text-sky-600"},K={class:"text-green-600"},Q={key:1,class:"h-96 flex text-center font-bold uppercase text-2xl px-4 justify-center items-center"},W={key:0,class:"md:w-full font-bold p-6 pt-12"},X={key:0},Y={class:"mb-8 text-center text-2xl font-bold uppercase"},Z={class:"space-y-6"},ee={key:1},ne={__name:"Index",props:{tableData:{type:Array}},setup(t){const e=$(),r=w();e.initOn(),g(!1);const p=g(null),I=f=>{p.value=f,e.showDeleteUser=!0};g("");const k=O(()=>r.auth?(e.validateItems(),!0):(e.playerItems=[],e.selectItems=[],!1));return(f,h)=>(n(),i(x,null,[b(U,null,{default:v(()=>[a("div",N,[l(e).load&&l(e).game?(n(),i("div",{key:0,class:"px-2 sm:px-4 lg:px-6",data:k.value},[a("div",L,[a("div",F,[a("span",M,c(l(e).game.name),1)])]),a("div",P,[a("div",{class:d(l(e).game.type==1?"border-none select-none text-sm py-2 columns-1 sm:columns-1 md:columns-2 lg:columns-3 xl:columns-4":"border-none select-none text-sm py-2 columns-1 sm:columns-2 md:columns-3 lg:columns-4 xl:columns-5")},[(n(!0),i(x,null,E(l(e).table,(s,te)=>(n(),i("div",{class:d([s.player?s.player.verified?"bg-purple-600/75 dark:bg-purple-600/75 text-white":"bg-red-600/90 dark:bg-red-600/90 text-white cursor-pointer":"bg-gray-600/50","inline-flex rounded-lg overflow-hidden mb-1.5 h-7 w-full"]),onClick:se=>s.player?I(s):null},[a("div",{class:d(["flex items-center",s.player?s.player.verified?"bg-purple-800/75 dark:bg-purple-950/75 text-white":"bg-red-800/90 dark:bg-red-950/90 text-white":"bg-gray-600 dark:bg-gray-800 text-white"]),title:s.name},[a("div",{class:d(["truncate font-bold uppercase border-none px-2",l(e).game.type==1?"w-32":l(e).game.name.includes("(Invertido)")?"w-16 text-center":l(e).game.name.includes("(3 Números)")?"w-20 text-center":"w-12 text-center"])},c(s.name),3)],10,z),a("div",{class:"w-full font-bold border-none focus:outline-none flex items-center truncate",title:s.player&&s.player.username?s.player.username:s.name+" esta disponible"},[s.player?(n(),i("div",R,[s.player.id?(n(),y(A,{key:0,src:s.player.avatar,class:d(["w-7 h-7 rounded-full",s.player.verified?"border  border-yellow-500":""])},null,8,["src","class"])):u("",!0),s.player.verified?(n(),y(l(T),{key:1,class:"absolute -bottom-0 -right-0.5 size-2.5 stroke-gray-800 fill-yellow-500"})):u("",!0)])):u("",!0),s.player?(n(),i("div",V,c(s.player.nick),1)):u("",!0)],8,G)],10,j))),256))],2)]),a("div",q,[a("div",H,[a("div",J,"ANOTADOS: "+c(l(e).getTableSpaceOcuped),1),a("div",K,"CUPOS: "+c(l(e).getTableSpaceFree),1)])])],8,B)):(n(),i("div",Q,[b(_)]))])]),_:1}),b(S,{show:l(e).showDeleteUser,classes:["sm:max-w-[400px]"],closeclass:"true",footerclass:"hidden",titleclass:"hidden"},{content:v(()=>[a("button",{onClick:h[0]||(h[0]=s=>l(e).showDeleteUser=!1),class:"absolute flex justify-center items-center top-0 right-0 w-12 h-12 p-2 hover:p-1 transition-all rounded-md rounded-br-none text-red-100 dark:text-red-100 hover:bg-red-500 hover:text-white"},[b(D,{class:"!w-full !h-full"})]),l(r).auth&&l(e).load?(n(),i("div",W,[p.value?(n(),i("div",X,[a("div",Y,[a("div",null,"¿ SEGURO DE SACAR DE LA TABLA A "+c(p.value.player.nick)+" ?",1)]),a("div",Z,[a("button",{onClick:h[1]||(h[1]=s=>l(e).deleteUserInTable(p.value)),class:d(["bg-red-600 hover:bg-red-500","text-white w-full py-2 px-4 uppercase font-bold text-xl rounded-lg"])},[f.waiting?(n(),y(_,{key:0,class:"mx-auto"})):(n(),i("span",ee,"ELIMINAR"))])])])):u("",!0)])):u("",!0)]),_:1},8,["show"])],64))}};export{ne as default};
